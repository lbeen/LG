<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.report.kanban.mapper.MaterialKanbanMapper">
    <select id="barrelRecyclingList" parameterType="Map" resultType="Record">
        SELECT distinct apc.FURNACE_NUMBER_S,
                        t.FEEDER_CODE_S,
                        T.FEEDING_TIME_T
        FROM AT_PM_MATERIALPREPARATION2 t
                 left join AT_PM_CRYSTALRODSORDER apc on t.CRYSTAL_ORDER_NUMBER_S = apc.CRYSTAL_ORDER_NUMBER_S
        WHERE t.QUANTITY_F > 0
          AND t.RELEASE_TIME_T IS NULL
          AND (apc.STORAGE_AREA_NUMBER_S = #{area1} OR apc.STORAGE_AREA_NUMBER_S = #{area2})
          and t.FEEDER_CODE_S like 'S1JLC%'
        order by apc.FURNACE_NUMBER_S
    </select>

    <select id="resistanceAndLifetime" parameterType="Map" resultType="Record">
        SELECT AC.CRYSTAL_NUMBER_S   CRYSTAL_NUMBER,
               AC.SPEC_S             SPEC,
               (SELECT round((NVL(AD3.RESISTANCE_VALUE_A3_F, 0) +
                              NVL(AD3.RESISTANCE_VALUE_A4_F, 0) +
                              NVL(AD3.RESISTANCE_VALUE_A5_F, 0) +
                              NVL(AD3.RESISTANCE_VALUE_A6_F, 0)) / 4, 3)
                FROM AT_QM_DETECTIONRESISTANCE AD3
                WHERE AD3.CRYSTAL_NUMBER_S = AL.CRYSTAL_NUMBER_S || '10'
                  AND AD3.DETECTION_TYPE_S = '首检'
                  AND ROWNUM = 1) AS ABIANJUN,

               (SELECT AD.RESISTANCE_VALUE_AMAX_F
                FROM AT_QM_DETECTIONRESISTANCE AD
                WHERE AD.CRYSTAL_NUMBER_S = AL.CRYSTAL_NUMBER_S || '10'
                  AND AD.DETECTION_TYPE_S = '首检'
                  AND ROWNUM = 1) AS AMAX,

               (SELECT RESISTANCE_BAVERAGE_F
                FROM AT_QM_DETECTIONRESISTANCE AD
                         LEFT JOIN AT_PM_WORKBLANKLINEATION AW
                                   ON AD.CRYSTAL_NUMBER_S = AW.CRYSTAL_NUMBER_S
                                       AND AD.DETECTION_TYPE_S = '首检'
                WHERE AW.WORKBLANK_NUMBER_S = AL.CRYSTAL_NUMBER_S
                  AND (AW.HEAD_TAIL_LOGO_S = 'W' OR AL.LINEATION_SEGMENTS_I = 1)
                  AND ROWNUM = 1) AS BPINGJUN,

               (SELECT AD.RESISTANCE_VALUE_BMIN_F
                FROM AT_PM_WORKBLANKLINEATION AW
                         LEFT JOIN AT_QM_DETECTIONRESISTANCE AD
                                   ON AD.CRYSTAL_NUMBER_S = AW.CRYSTAL_NUMBER_S
                                       AND AD.DETECTION_TYPE_S = '首检'
                WHERE AW.WORKBLANK_NUMBER_S = AL.CRYSTAL_NUMBER_S
                  AND (AW.HEAD_TAIL_LOGO_S = 'W' OR AL.LINEATION_SEGMENTS_I = 1)
                  AND ROWNUM = 1) AS BMIN,

               (SELECT AD1.LIFETIME_A_F
                FROM AT_QM_DETECTIONLIFETIME AD1
                WHERE AD1.CRYSTAL_NUMBER_S = AL.CRYSTAL_NUMBER_S || '10'
                  AND AD1.DETECTION_TYPE_S = '首检'
                  AND ROWNUM = 1) AS TASHOUMING,

               (SELECT AD.LIFETIME_B_F
                FROM AT_PM_WORKBLANKLINEATION AW
                         LEFT JOIN AT_QM_DETECTIONLIFETIME AD
                                   ON AD.CRYSTAL_NUMBER_S = AW.CRYSTAL_NUMBER_S
                                       AND AD.DETECTION_TYPE_S = '首检'
                WHERE AW.WORKBLANK_NUMBER_S = AL.CRYSTAL_NUMBER_S
                  AND (AW.HEAD_TAIL_LOGO_S = 'W' OR AL.LINEATION_SEGMENTS_I = 1)
                  AND ROWNUM = 1) AS WBSHOUMING
        FROM AT_PM_CRYSTALRODSORDER AC
                 LEFT JOIN AT_PM_LINEATIONANDDETECTION AL
                           ON AL.CRYSTAL_NUMBER_S = AC.CRYSTAL_NUMBER_S
        WHERE AC.CRYSTAL_NUMBER_S in
              (select distinct t.BLANK_BAR_NUMBER_S
               from AT_QM_DETECTIONRESISTANCE t
               where t.CREATION_TIME > SYSDATE - 6 / 24
                 and t.DETECTION_TYPE_S = '首检')
          AND GET_SHOP_BYCN(AC.CRYSTAL_NUMBER_S) = #{area}
        ORDER BY AC.FURNACE_NUMBER_S ASC

    </select>
    <select id="PolycrystallineData" parameterType="Map" resultType="Record">
        SELECT sum(apc.QUANTITY_INVEN_F) INVEN,
               '多晶'                      types
        FROM AT_PM_CLEANACCOMPANYINGORDER apc
        WHERE LENGTH(APC.CLEAN_BATCH_NO_S) > 20
          AND apc.QUANTITY_INVEN_F > 0.0

    </select>
    <select id="PolycrystallineDetailedData" parameterType="Map" resultType="Record">
        SELECT apc.CLEAN_BATCH_NO_S,
               apc.QUANTITY_INVEN_F,
               TO_CHAR(apc.END_TIME_T, 'YYYY-MM-DD HH24:MI:SS')   END_TIME_T,
               ROUND(SYSDATE - CAST((apc.END_TIME_T) AS DATE), 2) DAYS
        FROM AT_PM_CLEANACCOMPANYINGORDER apc
        WHERE LENGTH(APC.CLEAN_BATCH_NO_S) > 20
          AND apc.QUANTITY_INVEN_F > 0.01
        ORDER BY apc.END_TIME_T
    </select>
    <select id="RedrawnMaterialData" parameterType="Map" resultType="Record">
        SELECT sum(apc.QUANTITY_INVEN_F) INVEN,
        t1.DICTIONARYDESC_S      NAME
        FROM AT_PM_CLEANACCOMPANYINGORDER apc
        LEFT JOIN (SELECT
        distinct apr.LOT_NUMBER_S ,asd.DICTIONARYDESC_S
        FROM
        AT_PM_RAWMATERIALORDER apr
        LEFT JOIN AT_PM_SORTINGRECORDS aps ON apr.ORDER_ITEM_NUMBER_S = aps.RAW_ORDER_NUMBER_S
        LEFT JOIN AT_SM_DATADICTIONARYRELATION asd ON aps.PART_NUMBER_S = asd.DICTIONARYCODE_S) t1
        ON t1.LOT_NUMBER_S = substr(apc.RECEVICE_BATCH_S, 0, LENGTH(t1.LOT_NUMBER_S))

        WHERE LENGTH(APC.CLEAN_BATCH_NO_S) &lt;20
        AND apc.QUANTITY_INVEN_F > 0.01
        GROUP BY t1.DICTIONARYDESC_S
    </select>
    <select id="RedrawnMaterialDetailedData" parameterType="Map" resultType="Record">
        select t1.*,
               min(TO_CHAR(api.CREATE_TIME_T, 'YYYY-MM-DD HH24:MI:SS')) CREATE_TIME_T,
               ROUND(SYSDATE - CAST(min(api.CREATE_TIME_T) AS DATE), 2) DAYS
        from (SELECT distinct apc.CLEAN_BATCH_NO_S,
                              APR.SPEC_S,
                              apc.QUANTITY_INVEN_F,
                              atw.column_2_s
              FROM AT_PM_CLEANACCOMPANYINGORDER apc
                       LEFT JOIN AT_PM_RAWMATERIALORDER apr
                                 ON apr.LOT_NUMBER_S = substr(apc.RECEVICE_BATCH_S, 0, LENGTH(apr.LOT_NUMBER_S))
                       left join AT_TM_WAREHOUSINGBATCH atw on atw.code_s = substr(apc.CLEAN_BATCH_NO_S, 12, 2)
              WHERE LENGTH(APC.CLEAN_BATCH_NO_S) &lt; 20
                AND apc.QUANTITY_INVEN_F > 0.01) t1
                 left join AT_PM_INVENTORYHISTORY api on t1.CLEAN_BATCH_NO_S = api.LOT_NUMBER_S
        where api.TRAN_TYPE_I = 3
        group by t1.CLEAN_BATCH_NO_S, t1.QUANTITY_INVEN_F, t1.SPEC_S, t1.column_2_s
        ORDER BY min(api.CREATE_TIME_T)
    </select>

</mapper>